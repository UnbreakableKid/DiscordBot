export { preferredLanguages };
const simpleLanguageRegExp = /^\s*([^\s\-;]+)(?:-([^\s;]+))?\s*(?:;(.*))?$/;
/**
 * Parse the Accept-Language header.
 */ function parseAcceptLanguage(accept) {
  const accepts = accept.split(",");
  const parsedEncodings = [];
  for (let i = 0; i < accepts.length; i++) {
    const language = parseLanguage(accepts[i].trim(), i);
    if (language) {
      parsedEncodings.push(language);
    }
  }
  return parsedEncodings;
}
/**
 * Parse a language from the Accept-Language header.
 */ function parseLanguage(str, i) {
  const match = simpleLanguageRegExp.exec(str);
  if (!match) return null;
  const prefix = match[1];
  const suffix = match[2];
  let full = prefix;
  if (suffix) full += "-" + suffix;
  let q = 1;
  if (match[3]) {
    const params = match[3].split(";");
    for (let j = 0; j < params.length; j++) {
      const p = params[j].split("=");
      if (p[0] === "q") q = parseFloat(p[1]);
    }
  }
  return {
    prefix,
    suffix,
    q,
    i,
    full,
  };
}
/**
 * Get the priority of a language.
 */ function getLanguagePriority(language, accepted, index) {
  let priority = {
    o: -1,
    q: 0,
    s: 0,
  };
  for (let i = 0; i < accepted.length; i++) {
    const spec = specify(language, accepted[i], index);
    if (
      spec &&
      (priority.s - spec.s || priority.q - spec.q || priority.o - spec.o) < 0
    ) {
      priority = spec;
    }
  }
  return priority;
}
/**
 * Get the specificity of the language.
 */ function specify(language, spec, index) {
  const p = parseLanguage(language);
  if (!p) return null;
  let s = 0;
  if (spec.full.toLowerCase() === p.full.toLowerCase()) {
    s |= 4;
  } else if (spec.prefix.toLowerCase() === p.full.toLowerCase()) {
    s |= 2;
  } else if (spec.full.toLowerCase() === p.prefix.toLowerCase()) {
    s |= 1;
  } else if (spec.full !== "*") {
    return null;
  }
  return {
    i: index,
    o: spec.i,
    q: spec.q,
    s,
  };
}
/**
 * Get the preferred languages from an Accept-Language header.
 */ function preferredLanguages(accept, provided) {
  // RFC 2616 sec 14.4: no header = *
  const accepts = parseAcceptLanguage(accept === null ? "*" : accept || "");
  if (!provided) {
    // sorted list of all languages
    return accepts.filter(isQuality).sort(compareSpecs).map(getFullLanguage);
  }
  const priorities = provided.map(function getPriority(type, index) {
    return getLanguagePriority(type, accepts, index);
  });
  // sorted list of accepted languages
  return priorities.filter(isQuality).sort(compareSpecs).map(
    function getLanguage(priority) {
      return provided[priorities.indexOf(priority)];
    },
  );
}
/**
 * Compare two specs.
 */ function compareSpecs(a, b) {
  return b.q - a.q || b.s - a.s || a.o - b.o || a.i - b.i || 0;
}
/**
 * Get full language string.
 */ function getFullLanguage(spec) {
  return spec.full;
}
/**
 * Check if a spec has any quality.
 */ function isQuality(spec) {
  return spec.q > 0;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxodHRwczovL2Rlbm8ubGFuZC94L25lZ290aWF0b3JAMS4wLjEvc3JjL2xhbmd1YWdlLnRzPiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9qc2h0dHAvbmVnb3RpYXRvci9ibG9iL21hc3Rlci9saWIvbGFuZ3VhZ2UuanNcbiAqIENvcHlyaWdodChjKSAyMDEyIElzYWFjIFouIFNjaGx1ZXRlclxuICogQ29weXJpZ2h0KGMpIDIwMTQgRmVkZXJpY28gUm9tZXJvXG4gKiBDb3B5cmlnaHQoYykgMjAxNC0yMDE1IERvdWdsYXMgQ2hyaXN0b3BoZXIgV2lsc29uXG4gKiBDb3B5cmlnaHQoYykgMjAyMCBIZW5yeSBaaHVhbmdcbiAqIE1JVCBMaWNlbnNlZFxuICovXG5cbmltcG9ydCB0eXBlIHsgUHJpb3JpdHkgfSBmcm9tIFwiLi90eXBlcy50c1wiO1xuXG5leHBvcnQgeyBwcmVmZXJyZWRMYW5ndWFnZXMgfTtcblxuY29uc3Qgc2ltcGxlTGFuZ3VhZ2VSZWdFeHAgPSAvXlxccyooW15cXHNcXC07XSspKD86LShbXlxccztdKykpP1xccyooPzo7KC4qKSk/JC87XG5cbmludGVyZmFjZSBMYW5ndWFnZSB7XG4gIHByZWZpeDogc3RyaW5nO1xuICBzdWZmaXg6IHN0cmluZztcbiAgZnVsbDogc3RyaW5nO1xuICBxOiBudW1iZXI7XG4gIGk/OiBudW1iZXI7XG59XG5cbi8qKlxuICogUGFyc2UgdGhlIEFjY2VwdC1MYW5ndWFnZSBoZWFkZXIuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlQWNjZXB0TGFuZ3VhZ2UoYWNjZXB0OiBzdHJpbmcpOiBMYW5ndWFnZVtdIHtcbiAgY29uc3QgYWNjZXB0cyA9IGFjY2VwdC5zcGxpdChcIixcIik7XG4gIGNvbnN0IHBhcnNlZEVuY29kaW5nczogTGFuZ3VhZ2VbXSA9IFtdO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYWNjZXB0cy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGxhbmd1YWdlID0gcGFyc2VMYW5ndWFnZShhY2NlcHRzW2ldLnRyaW0oKSwgaSk7XG5cbiAgICBpZiAobGFuZ3VhZ2UpIHtcbiAgICAgIHBhcnNlZEVuY29kaW5ncy5wdXNoKGxhbmd1YWdlKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcGFyc2VkRW5jb2RpbmdzO1xufVxuXG4vKipcbiAqIFBhcnNlIGEgbGFuZ3VhZ2UgZnJvbSB0aGUgQWNjZXB0LUxhbmd1YWdlIGhlYWRlci5cbiAqL1xuZnVuY3Rpb24gcGFyc2VMYW5ndWFnZShzdHI6IHN0cmluZywgaT86IG51bWJlcik6IExhbmd1YWdlIHwgbnVsbCB7XG4gIGNvbnN0IG1hdGNoID0gc2ltcGxlTGFuZ3VhZ2VSZWdFeHAuZXhlYyhzdHIpO1xuICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBwcmVmaXggPSBtYXRjaFsxXTtcbiAgY29uc3Qgc3VmZml4ID0gbWF0Y2hbMl07XG4gIGxldCBmdWxsID0gcHJlZml4O1xuXG4gIGlmIChzdWZmaXgpIGZ1bGwgKz0gXCItXCIgKyBzdWZmaXg7XG5cbiAgbGV0IHEgPSAxO1xuICBpZiAobWF0Y2hbM10pIHtcbiAgICBjb25zdCBwYXJhbXMgPSBtYXRjaFszXS5zcGxpdChcIjtcIik7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBwYXJhbXMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHAgPSBwYXJhbXNbal0uc3BsaXQoXCI9XCIpO1xuICAgICAgaWYgKHBbMF0gPT09IFwicVwiKSBxID0gcGFyc2VGbG9hdChwWzFdKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByZWZpeCxcbiAgICBzdWZmaXgsXG4gICAgcSxcbiAgICBpLFxuICAgIGZ1bGwsXG4gIH07XG59XG5cbi8qKlxuICogR2V0IHRoZSBwcmlvcml0eSBvZiBhIGxhbmd1YWdlLlxuICovXG5mdW5jdGlvbiBnZXRMYW5ndWFnZVByaW9yaXR5KFxuICBsYW5ndWFnZTogc3RyaW5nLFxuICBhY2NlcHRlZDogTGFuZ3VhZ2VbXSxcbiAgaW5kZXg6IG51bWJlcixcbik6IFByaW9yaXR5IHtcbiAgbGV0IHByaW9yaXR5ID0geyBvOiAtMSwgcTogMCwgczogMCB9O1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYWNjZXB0ZWQubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzcGVjID0gc3BlY2lmeShsYW5ndWFnZSwgYWNjZXB0ZWRbaV0sIGluZGV4KTtcblxuICAgIGlmIChcbiAgICAgIHNwZWMgJiZcbiAgICAgIChwcmlvcml0eS5zIC0gc3BlYy5zIHx8IHByaW9yaXR5LnEgLSBzcGVjLnEgfHwgcHJpb3JpdHkubyAtIHNwZWMubykgPCAwXG4gICAgKSB7XG4gICAgICBwcmlvcml0eSA9IHNwZWM7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHByaW9yaXR5O1xufVxuXG4vKipcbiAqIEdldCB0aGUgc3BlY2lmaWNpdHkgb2YgdGhlIGxhbmd1YWdlLlxuICovXG5mdW5jdGlvbiBzcGVjaWZ5KFxuICBsYW5ndWFnZTogc3RyaW5nLFxuICBzcGVjOiBMYW5ndWFnZSxcbiAgaW5kZXg6IG51bWJlcixcbik6IFByaW9yaXR5IHwgbnVsbCB7XG4gIGNvbnN0IHAgPSBwYXJzZUxhbmd1YWdlKGxhbmd1YWdlKTtcbiAgaWYgKCFwKSByZXR1cm4gbnVsbDtcbiAgbGV0IHMgPSAwO1xuICBpZiAoc3BlYy5mdWxsLnRvTG93ZXJDYXNlKCkgPT09IHAuZnVsbC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgcyB8PSA0O1xuICB9IGVsc2UgaWYgKHNwZWMucHJlZml4LnRvTG93ZXJDYXNlKCkgPT09IHAuZnVsbC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgcyB8PSAyO1xuICB9IGVsc2UgaWYgKHNwZWMuZnVsbC50b0xvd2VyQ2FzZSgpID09PSBwLnByZWZpeC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgcyB8PSAxO1xuICB9IGVsc2UgaWYgKHNwZWMuZnVsbCAhPT0gXCIqXCIpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaTogaW5kZXgsXG4gICAgbzogc3BlYy5pISxcbiAgICBxOiBzcGVjLnEsXG4gICAgcyxcbiAgfTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHByZWZlcnJlZCBsYW5ndWFnZXMgZnJvbSBhbiBBY2NlcHQtTGFuZ3VhZ2UgaGVhZGVyLlxuICovXG5mdW5jdGlvbiBwcmVmZXJyZWRMYW5ndWFnZXMoXG4gIGFjY2VwdDogc3RyaW5nIHwgbnVsbCxcbiAgcHJvdmlkZWQ/OiBzdHJpbmdbXSxcbik6IHN0cmluZ1tdIHtcbiAgLy8gUkZDIDI2MTYgc2VjIDE0LjQ6IG5vIGhlYWRlciA9ICpcbiAgY29uc3QgYWNjZXB0cyA9IHBhcnNlQWNjZXB0TGFuZ3VhZ2UoXG4gICAgYWNjZXB0ID09PSBudWxsID8gXCIqXCIgOiBhY2NlcHQgfHwgXCJcIixcbiAgKTtcblxuICBpZiAoIXByb3ZpZGVkKSB7XG4gICAgLy8gc29ydGVkIGxpc3Qgb2YgYWxsIGxhbmd1YWdlc1xuICAgIHJldHVybiBhY2NlcHRzXG4gICAgICAuZmlsdGVyKGlzUXVhbGl0eSlcbiAgICAgIC5zb3J0KGNvbXBhcmVTcGVjcylcbiAgICAgIC5tYXAoZ2V0RnVsbExhbmd1YWdlKTtcbiAgfVxuXG4gIGNvbnN0IHByaW9yaXRpZXMgPSBwcm92aWRlZC5tYXAoZnVuY3Rpb24gZ2V0UHJpb3JpdHkodHlwZSwgaW5kZXgpIHtcbiAgICByZXR1cm4gZ2V0TGFuZ3VhZ2VQcmlvcml0eSh0eXBlLCBhY2NlcHRzLCBpbmRleCk7XG4gIH0pO1xuXG4gIC8vIHNvcnRlZCBsaXN0IG9mIGFjY2VwdGVkIGxhbmd1YWdlc1xuICByZXR1cm4gcHJpb3JpdGllcy5maWx0ZXIoaXNRdWFsaXR5KS5zb3J0KGNvbXBhcmVTcGVjcykubWFwKFxuICAgIGZ1bmN0aW9uIGdldExhbmd1YWdlKHByaW9yaXR5KSB7XG4gICAgICByZXR1cm4gcHJvdmlkZWRbcHJpb3JpdGllcy5pbmRleE9mKHByaW9yaXR5KV07XG4gICAgfSxcbiAgKTtcbn1cblxuLyoqXG4gKiBDb21wYXJlIHR3byBzcGVjcy5cbiAqL1xuZnVuY3Rpb24gY29tcGFyZVNwZWNzKGE6IGFueSwgYjogYW55KTogbnVtYmVyIHtcbiAgcmV0dXJuIChiLnEgLSBhLnEpIHx8IChiLnMgLSBhLnMpIHx8IChhLm8gLSBiLm8pIHx8IChhLmkgLSBiLmkpIHx8IDA7XG59XG5cbi8qKlxuICogR2V0IGZ1bGwgbGFuZ3VhZ2Ugc3RyaW5nLlxuICovXG5mdW5jdGlvbiBnZXRGdWxsTGFuZ3VhZ2Uoc3BlYzogTGFuZ3VhZ2UpOiBzdHJpbmcge1xuICByZXR1cm4gc3BlYy5mdWxsO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgc3BlYyBoYXMgYW55IHF1YWxpdHkuXG4gKi9cbmZ1bmN0aW9uIGlzUXVhbGl0eShzcGVjOiBMYW5ndWFnZSB8IFByaW9yaXR5KTogYm9vbGVhbiB7XG4gIHJldHVybiBzcGVjLnEgPiAwO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJTQVdTLGtCQUFrQjtNQUVyQixvQkFBb0I7QUFVMUIsRUFFRyxBQUZIOztDQUVHLEFBRkgsRUFFRyxVQUNNLG1CQUFtQixDQUFDLE1BQWM7VUFDbkMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUMsQ0FBRztVQUMxQixlQUFlO1lBRVosQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO2NBQzdCLFFBQVEsR0FBRyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQztZQUUvQyxRQUFRO1lBQ1YsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFROzs7V0FJMUIsZUFBZTs7QUFHeEIsRUFFRyxBQUZIOztDQUVHLEFBRkgsRUFFRyxVQUNNLGFBQWEsQ0FBQyxHQUFXLEVBQUUsQ0FBVTtVQUN0QyxLQUFLLEdBQUcsb0JBQW9CLENBQUMsSUFBSSxDQUFDLEdBQUc7U0FDdEMsS0FBSyxTQUFTLElBQUk7VUFFakIsTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDO1VBQ2hC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
